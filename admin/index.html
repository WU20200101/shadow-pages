<!doctype html>
<html lang="zh">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="/assets/css/base.css" />
  <link rel="stylesheet" href="/assets/css/admin.css" />
  <title>风险评估系统验证码生成器</title>
</head>

<body>
  <header class="topbar">
    <div class="topbar__inner">
      <div class="topbar__title">风险评估系统验证码生成器</div>
    </div>
  </header>

  <main class="wrap">
    <section class="panel">
      <div class="panel__hd">
        <div class="panel__hdL">
          <div class="h1">Admin Console</div>
          <div class="sub">生成一次性验证码 + 自动拼接发送文案（严格门控）</div>
        </div>
        <div class="panel__hdR muted">ADMIN KEY 不会保存，刷新页面即消失。</div>
      </div>

      <!-- Worker base -->
      <div class="block block--base">
        <div class="block__title">Worker API Base</div>
        <input id="base" class="input" value="https://shadow-api.wuxiaofei1985.workers.dev" />
        <div class="help">例：https://xxx.workers.dev</div>
      </div>

      <!-- ========= Desktop (compact) ========= -->
      <div class="desk">
        <div class="grid2">

          <!-- Step 1 -->
          <div class="card">
            <div class="card__hd">
              <div class="card__ttl">1）管理员密码</div>
              <div class="card__tip">确认后才能刷新与选择表单</div>
            </div>

            <div class="row2 row2--actions">
              <div>
                <label class="label">管理员密码</label>
                <input id="key" class="input" type="password" placeholder="请输入管理员密码" autocomplete="off" />
                <div class="help">请求头：X-ADMIN-KEY</div>
              </div>

              <div class="btncol">
                <button id="toggleKey" class="btn btn--ghost" type="button">显示密码</button>
                <button id="confirmKey" class="btn btn--primary" type="button">确认</button>
              </div>
            </div>
          </div>

          <!-- Step 2 -->
          <div class="card">
            <div class="card__hd">
              <div class="card__ttl">2）刷新列表</div>
              <div class="card__tip">从 Worker 拉取 active 的 pack</div>
            </div>

            <div class="row2 row2--actions">
              <div>
                <label class="label">选择表单</label>
                <select id="packSelect" class="input"></select>
                <div class="help">下拉显示：pack.display_name（中文名）</div>
              </div>

              <div class="btncol">
                <button id="reloadPacks" class="btn btn--primary" type="button">刷新列表</button>
              </div>
            </div>

            <div class="row2">
              <div>
                <label class="label">表单名称（只读）</label>
                <input id="formName" class="input" readonly />
              </div>
              <div>
                <label class="label">版本号（只读）</label>
                <input id="formVersion" class="input" readonly />
              </div>
            </div>
          </div>

          <!-- Step 3 -->
          <div class="card">
            <div class="card__hd">
              <div class="card__ttl">3）确认并锁定表单</div>
              <div class="card__tip">锁定后才能生成验证码</div>
            </div>

            <div class="row2 row2--actions">
              <div>
                <label class="label">客户入口链接</label>
                <input id="enterUrl" class="input" value="https://shadow-pages.pages.dev/enter" />
                <div class="help">将自动写入发送文案</div>
              </div>
              <div class="btncol">
                <button id="lockPack" class="btn btn--primary" type="button">确认并锁定表单</button>
              </div>
            </div>
          </div>

          <!-- Step 4 -->
          <div class="card">
            <div class="card__hd">
              <div class="card__ttl">4）生成验证码</div>
              <div class="card__tip">生成后自动拼接发送文案</div>
            </div>

            <div class="row2 row2--actions">
              <div>
                <label class="label">验证码</label>
                <input id="tokenOutInput" class="input" placeholder="生成后显示" readonly />
              </div>
              <div class="btncol">
                <button id="go" class="btn btn--primary" type="button">生成验证码</button>
              </div>
            </div>

            <div class="row2">
              <div>
                <label class="label">发送文案模板（可改）</label>
                <textarea id="msgTpl" class="textarea" rows="6" placeholder="支持占位符：{link} / {token}"></textarea>
                <div class="help">支持占位符：{link} / {token}</div>
              </div>
              <div>
                <label class="label">发送给客户的文本（生成后只读）</label>
                <textarea id="msgOut" class="textarea" rows="6" readonly placeholder="生成后显示"></textarea>
              </div>
            </div>
          </div>

          <!-- Step 5 -->
          <div class="card card--wide">
            <div class="card__hd">
              <div class="card__ttl">5）复制</div>
              <div class="card__tip">生成后才可复制</div>
            </div>

            <div class="row2 row2--btns">
              <button id="copyToken" class="btn btn--primary btn--wide" type="button" disabled>复制验证码</button>
              <button id="copyMsg" class="btn btn--primary btn--wide" type="button" disabled>复制发送文案</button>
            </div>

            <div class="row2 row2--btns row2--btns2">
              <button id="exportHistory" class="btn btn--ghost btn--wide" type="button">复制历史导出文本</button>
              <button id="clearHistory" class="btn btn--ghost btn--wide" type="button">清空历史（仅本机）</button>
            </div>

            <div id="status" class="status muted">就绪</div>
          </div>

        </div>
      </div>

      <!-- ========= Mobile (step layout) ========= -->
      <div class="mob">
        <div class="mstep">
          <div class="mstep__hd">
            <div class="mstep__ttl">1）管理员密码</div>
            <div class="mstep__tip">确认后才能刷新与选择表单</div>
          </div>
          <label class="label">管理员密码</label>
          <div class="mrow">
            <input id="m_key" class="input" type="password" placeholder="请输入管理员密码" autocomplete="off" />
            <button id="m_toggleKey" class="btn btn--ghost" type="button">显示</button>
            <button id="m_confirmKey" class="btn btn--primary" type="button">确认</button>
          </div>
          <div class="help">请求头：X-ADMIN-KEY</div>
        </div>

        <div class="mstep">
          <div class="mstep__hd">
            <div class="mstep__ttl">2）刷新列表</div>
            <div class="mstep__tip">从 Worker 拉取 active 的 pack</div>
          </div>
          <label class="label">选择表单</label>
          <div class="mrow">
            <select id="m_packSelect" class="input"></select>
            <button id="m_reloadPacks" class="btn btn--primary" type="button">刷新列表</button>
          </div>
          <div class="help">下拉显示：pack.display_name（中文名）</div>

          <div class="m2">
            <div>
              <label class="label">表单名称（只读）</label>
              <input id="m_formName" class="input" readonly />
            </div>
            <div>
              <label class="label">版本号（只读）</label>
              <input id="m_formVersion" class="input" readonly />
            </div>
          </div>
        </div>

        <div class="mstep">
          <div class="mstep__hd">
            <div class="mstep__ttl">3）确认并锁定表单</div>
            <div class="mstep__tip">锁定后才能生成验证码</div>
          </div>
          <label class="label">客户入口链接</label>
          <input id="m_enterUrl" class="input" value="https://shadow-pages.pages.dev/enter" />
          <div class="help">将自动写入发送文案</div>

          <button id="m_lockPack" class="btn btn--primary btn--wide" type="button">确认并锁定表单</button>
        </div>

        <div class="mstep">
          <div class="mstep__hd">
            <div class="mstep__ttl">4）生成验证码</div>
            <div class="mstep__tip">生成后自动拼接发送文案</div>
          </div>
          <label class="label">验证码</label>
          <div class="mrow">
            <input id="m_tokenOutInput" class="input" placeholder="生成后显示" readonly />
            <button id="m_go" class="btn btn--primary" type="button">生成</button>
          </div>

          <label class="label">发送文案模板（可改）</label>
          <textarea id="m_msgTpl" class="textarea" rows="5" placeholder="支持占位符：{link} / {token}"></textarea>

          <label class="label">发送给客户的文本（生成后只读）</label>
          <textarea id="m_msgOut" class="textarea" rows="6" readonly placeholder="生成后显示"></textarea>
        </div>

        <div class="mstep">
          <div class="mstep__hd">
            <div class="mstep__ttl">5）复制</div>
            <div class="mstep__tip">生成后才可复制</div>
          </div>
          <div class="mrow">
            <button id="m_copyToken" class="btn btn--primary btn--wide" type="button" disabled>复制验证码</button>
            <button id="m_copyMsg" class="btn btn--primary btn--wide" type="button" disabled>复制发送文案</button>
          </div>

          <div class="mrow">
            <button id="m_exportHistory" class="btn btn--ghost btn--wide" type="button">复制历史导出</button>
            <button id="m_clearHistory" class="btn btn--ghost btn--wide" type="button">清空历史</button>
          </div>

          <div id="m_status" class="status muted">就绪</div>
        </div>
      </div>

    </section>

    <!-- history -->
    <section class="panel panel--history">
      <div class="panel__hd panel__hd--thin">
        <div class="h2">历史记录（仅本机）</div>
      </div>

      <div class="tableWrap">
        <table class="table">
          <thead>
            <tr>
              <th>验证码</th>
              <th>发放日期</th>
              <th>表单名称</th>
              <th>版本号</th>
              <th class="t-right">操作</th>
            </tr>
          </thead>
          <tbody id="historyBody"></tbody>
        </table>
      </div>
    </section>
  </main>

  <script src="/assets/js/admin.js"></script>
</body>
</html>
